'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Spotter=function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,a),b)'string'==typeof b?this.selectors=document.querySelectorAll(b):'object'===('undefined'==typeof b?'undefined':_typeof(b))&&(b.length?this.selectors=b:this.selectors=[b]);else return;c&&'object'===('undefined'==typeof c?'undefined':_typeof(c))&&!c.length&&(this.options=c),this.windowHeight=window.innerHeight,this.windowWidth=window.innerWidth,this.defaults={animation:{name:'',duration:500,fillMode:'forwards',delay:0,timingFunction:'ease',iterationCount:'1',direction:'normal',playState:'running'},hide:!1,delay:0,stagger:0,offset:0,chainReaction:!1,restore:!1,partInView:!0,lazyLoadImages:!1,onSpotted:function onSpotted(){},onUnSpotted:function onUnSpotted(){}},this.init()}return _createClass(a,[{key:'init',value:function init(){this.updateSettings(this.options),this.prepareElements(),this.spotElements(),this.events()}},{key:'updateSettings',value:function updateSettings(b){if(b)for(var c in this.defaults)this.defaults.hasOwnProperty(c)&&void 0!==b[c]&&(this.defaults[c]=b[c])}},{key:'events',value:function events(){var d=this,b=document.documentElement.hasOwnProperty('touchmove')?'touchmove':'scroll',c=function(){d.windowHeight=window.innerHeight,d.windowWidth=window.innerWidth};window.addEventListener('resize',function(){requestAnimationFrame(d.spotElements.bind(d)),requestAnimationFrame(c.bind(d))},!1),window.addEventListener(b,function(){requestAnimationFrame(d.spotElements.bind(d))},!1)}},{key:'each',value:function each(b){if(b&&this.selectors.length){var c=this.defaults.offset,d=this.selectors.length;for(c;c<d;c++){var e=this.selectors[c];b(e,c)}}}},{key:'prepareElements',value:function prepareElements(){var b=this;this.each(function(c,d){b.defaults.hide&&b.hideElement(c),c.elementInView=!1,c.index=d})}},{key:'spotElements',value:function spotElements(){var b=this;this.each(function(c,d){b.inView(c)?!1===c.elementInView&&(b.defaults.onSpotted(c,d,b),b.spotHandler(c),c.elementInView=!0):!0===c.elementInView&&(b.defaults.onUnSpotted(c,d,b),b.defaults.restore&&b.removeAnimation(c),c.elementInView=!1)})}},{key:'spotHandler',value:function spotHandler(b){var c=this;setTimeout(function(){b&&(c.defaults.lazyLoadImages&&c.lazyLoad(b),c.defaults.animation&&c.addAnimation(b))},this.defaults.delay)}},{key:'inView',value:function inView(b){var c=b.getBoundingClientRect();if(this.defaults.partInView){if('number'==typeof this.defaults.partInView){var d=Math.abs(this.defaults.partInView);return this.windowHeight-this.windowHeight/d>c.top&&c.bottom>this.windowHeight/d}if('boolean'==typeof this.defaults.partInView)return(this.windowHeight>c.top&&0<c.top||0<c.bottom&&c.bottom<this.windowHeight)&&(this.windowWidth>c.left&&0<c.left||0<c.right&&c.right<this.windowWidth)}else return this.windowHeight>c.top&&0<c.bottom&&this.windowWidth>c.left&&0<c.right}},{key:'lazyLoad',value:function lazyLoad(b){function c(h){var j=new Image,k=h.getAttribute('data-src');j.onload=function(){h.removeAttribute('data-src'),h.setAttribute('src',k)},j.src=k}if(b)if(b.hasAttribute('data-src'))c(b);else{var d=b.querySelectorAll('img'),e=0,f=d.length;for(e;e<f;e++){var g=d[e];g.hasAttribute('data-src')&&c(g)}}}},{key:'showElement',value:function showElement(b){b&&(b.style.opacity='1')}},{key:'hideElement',value:function hideElement(b){b&&(b.style.opacity='0')}},{key:'addAnimation',value:function addAnimation(b){b&&(this.defaults.animation?'object'===_typeof(this.defaults.animation)?this.setAnimationAttributes(b):'string'==typeof this.defaults.animation&&this.addAnimationClass(b):b.hasAttribute('data-class')&&b.classList.add(b.getAttribute('data-class')))}},{key:'removeAnimation',value:function removeAnimation(b){b&&(this.defaults.animation?'object'===_typeof(this.defaults.animation)?this.removeAnimationAttributes(b):'string'==typeof this.defaults.animation&&this.removeAnimationClass(b):b.hasAttribute('data-class')&&b.classList.remove(b.getAttribute('data-class')))}},{key:'setAnimationAttributes',value:function setAnimationAttributes(b){var c=0;b&&(this.defaults.stagger&&'number'==typeof this.defaults.stagger&&(c=this.defaults.stagger*b.index),b.style.webkitAnimation=this.defaults.animation.name+' '+this.defaults.animation.duration+'ms '+this.defaults.animation.fillMode+' '+(this.defaults.animation.delay+c)+'ms '+this.defaults.animation.timingFunction+' '+this.defaults.animation.iterationCount+' '+this.defaults.animation.direction+' '+this.defaults.animation.playState,b.style.animation=this.defaults.animation.name+' '+this.defaults.animation.duration+'ms '+this.defaults.animation.fillMode+' '+(this.defaults.animation.delay+c)+'ms '+this.defaults.animation.timingFunction+' '+this.defaults.animation.iterationCount+' '+this.defaults.animation.direction+' '+this.defaults.animation.playState)}},{key:'removeAnimationAttributes',value:function removeAnimationAttributes(b){b&&(b.style.webkitAnimation='',b.style.animation='')}},{key:'addAnimationClass',value:function addAnimationClass(b){b&&b.classList.add(this.defaults.animation)}},{key:'removeAnimationClass',value:function removeAnimationClass(b){b&&b.classList.remove(this.defaults.animation)}}]),a}();
